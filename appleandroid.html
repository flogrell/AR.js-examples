<!doctype HTML>
<html>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<script src="js/aframe.min.js"></script>
<script src="js/aframe-ar.js"></script>
<script src="js/aframe-text-geometry-component.min.js"></script>
<script>
function isAndroid() {
  return /Android/i.test(navigator.userAgent);
}

AFRAME.registerComponent('vidhandler', {
  init: function () {
    if (isAndroid()) {
      this.toggle = false;
      this.vid = document.querySelector("#vidtest");
      this.vid.pause();
    } else {
      // Falls kein Android-Ger√§t, das Video komplett entfernen
      const vidEntity = document.querySelector("#vidtest");
      if (vidEntity) {
        vidEntity.parentNode.removeChild(vidEntity);
      }
    }
  },
  tick:function(){
    if (isAndroid() && this.el.object3D.visible == true){
      if(!this.toggle){
        this.toggle = true;
        this.vid.play();
      }
    } else if (isAndroid()) {
      this.toggle = false;
      this.vid.pause();
    }
  }
});
</script>

<!--<div id="loader" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:sans-serif;">
  Loading AR Scene...
</div>

<script>
  document.querySelector('a-scene').addEventListener('loaded', () => {
    document.getElementById('loader').style.display = 'none';
  });
</script> -->
<body style="margin: 0px; overflow: hidden;">
	
<!-- add some info at the top of the page -->
<p align="center">Willkommen in der AR-APP<br>Schaut euch nach AR-Markern um und scannt sie!<br>Look for AR-marks and scan them!</p> 
	
<a-scene embedded vr-mode-ui="enabled: true;" 
	arjs="debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" 
	renderer= "precision: medium; colorManagement: true;">

	
 <a-assets>
              <a-asset-item id="exoFont" src="fonts/exoBlack.typeface.json"></a-asset-item>
	      <img id="pixels" src="images/pixels.png" /> 
	      <img id="fridge" src="images/fridge.JPG" />
	      <img id="imgtest" src="images/kuehlbox.jpg"> 
	      <!--<a-asset-item id="dom" src="models/dom/A95XNTJMFCEC0P92ZM4PJXDN6.gltf"></a-asset-item>
	      <a-asset-item id="else" src="models/goldelse/model.gltf"></a-asset-item>
	      <a-asset-item id="else-obj" src="models/goldelse_obj/model.obj"></a-asset-item>
    	      <a-asset-item id="else-mtl" src="models/goldelse_obj/model.mtl"></a-asset-item>
	      <a-asset-item id="bbtor-obj" src="models/bbtor_obj/model.obj"></a-asset-item>
    	      <a-asset-item id="bbtor-mtl" src="models/bbtor_obj/model.mtl"></a-asset-item>
	      <a-asset-item id="tv-obj" src="models/tvtowerobj/model.obj"></a-asset-item>
    	      <a-asset-item id="tv-mtl" src="models/tvtowerobj/model.mtl"></a-asset-item>
	      <video id="vidtest" loop="true" src="videos/rick.mp4" crossorigin></video>
	      <img id="img360" src="images/kuehlschrank.jpeg" />-->
    </a-assets>
    <!--
    <a-marker type="barcode" value="0">
        <a-entity position="0 -1 -1" 
                  rotation="0 0 0"
                  scale="0.60 0.60 0.60"
                  gltf-model="#dom" >
        </a-entity>
    </a-marker>

    <a-marker type="barcode" value="10">
        <a-entity position="0 -1 -1" 
                  rotation="270 90 0"
                  scale="0.50 0.50 0.50"
                  obj-model="obj: #else-obj; mtl: #else-mtl" >
        </a-entity>
    </a-marker>

    <a-marker type="barcode" value="15">
        <a-entity position="0 -1 -1" 
                  rotation="270 90 0"
                  scale="0.30 0.30 0.30"
                  obj-model="obj: #bbtor-obj; mtl: #bbtor-mtl" >
        </a-entity>
    </a-marker>
-->
<!-- for tests:	
    <a-marker type="barcode" value="15">
        <a-entity position="0 0 0" 
                  rotation="270 90 0"
                  scale="0.30 0.30 0.30"
                  gltf-model="#bbtor" >
        </a-entity>
    </a-marker>
-->
<!--
    <a-marker type="barcode" value="9">
        <a-entity position="0 -1 -1" 
                  rotation="0 0 0"
                  scale="0.009 0.009 0.009"
                  obj-model="obj: #tv-obj; mtl: #tv-mtl">
        </a-entity>
    </a-marker>
-->
     <a-marker type="barcode" value="1">
	<a-plane position="0 0 -1" 
                 rotation="-90 0 0"
                 material="src: #imgtest;">
        </a-plane>
    </a-marker>
<!--
    <a-marker type="barcode" value="2" vidhandler>
	 <a-plane position='0 0 0'  
		 rotation="-90 0 0" 
		 material='src:#vidtest'>
	</a-plane>
    </a-marker>
-->
    <!-- 3D text -->
    <a-marker type="barcode" value="3">
      	<a-entity text-geometry="value: Ein AR Marker. ; font: #exoFont; size: 0.2;"
      			material="color: blue; src: #pixels; repeat: 0.5 0.5;" 
      			rotation="-90 0 0" position="-1 -1 -1">
      	</a-entity>
    </a-marker>

<!-- for tests:
    <a-marker type="barcode" value="11">
      	<a-link href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" image="#img360" title="" peekmoder=true rotation="-90 0 0">
      	</a-link>
    </a-marker>
-->
<!-- 
    <a-marker type="barcode" value="12">
      	<a-link image="#img360" title="Minibar" position="0 0 -1" rotation="-90 0 0">
      	</a-link>
    </a-marker>
-->

    <a-marker type="barcode" value="12">
	<a-plane position="0 0 -1" 
                 rotation="-90 0 0"
                 material="src: #fridge">
        </a-plane>
    </a-marker>
    
    <a-entity camera></a-entity>
    
</a-scene>
<script>
document.querySelector('a-scene').addEventListener('loaded', () => {
  console.log('Scene is loaded, now loading secondary assets...');

  const assets = document.querySelector('a-assets');
  const scene = document.querySelector('a-scene');

  const delayedAssets = [
    { type: 'a-asset-item', id: 'dom', src: 'models/dom/A95XNTJMFCEC0P92ZM4PJXDN6.gltf' },
    { type: 'a-asset-item', id: 'else-obj', src: 'models/goldelse_obj/model.obj' },
    { type: 'a-asset-item', id: 'else-mtl', src: 'models/goldelse_obj/model.mtl' },
    { type: 'a-asset-item', id: 'bbtor-obj', src: 'models/bbtor_obj/model.obj' },
    { type: 'a-asset-item', id: 'bbtor-mtl', src: 'models/bbtor_obj/model.mtl' },
    { type: 'a-asset-item', id: 'tv-obj', src: 'models/tvtowerobj/model.obj' },
    { type: 'a-asset-item', id: 'tv-mtl', src: 'models/tvtowerobj/model.mtl' },
    { type: 'video', id: 'vidtest', src: 'videos/rick.mp4', loop: true, crossorigin: 'anonymous' },
    { type: 'img', id: 'fridge', src: 'images/fridge.JPG' },
    { type: 'img', id: 'imgtest', src: 'images/kuehlbox.jpg' },
  ];

  let loadedCount = 0;

  delayedAssets.forEach(asset => {
    const el = document.createElement(asset.type);
    for (const key in asset) {
      if (key !== 'type') el.setAttribute(key, asset[key]);
    }

    el.addEventListener('loaded', () => {
      loadedCount++;
      console.log(`Loaded asset ${asset.id} (${loadedCount}/${delayedAssets.length})`);
      if (loadedCount === delayedAssets.length) {
        console.log("All delayed assets loaded!");
        insertEntities();
      }
    });

    assets.appendChild(el);
    console.log(`Appended asset:`, el.outerHTML);
  });

function insertEntities() {
  // Marker 0 - GLTF model
  const marker0 = document.querySelector('a-marker[value="0"]');
  const ent0 = document.createElement('a-entity');
  ent0.setAttribute('gltf-model', '#dom');
  ent0.setAttribute('position', '0 -1 -1');
  ent0.setAttribute('scale', '0.6 0.6 0.6');
  marker0.appendChild(ent0);

  // Marker 10 - Goldelse OBJ/MTL
  const marker10 = document.querySelector('a-marker[value="10"]');
  const ent10 = document.createElement('a-entity');
  ent10.setAttribute('obj-model', 'obj: #else-obj; mtl: #else-mtl');
  ent10.setAttribute('position', '0 -1 -1');
  ent10.setAttribute('scale', '0.5 0.5 0.5');
  ent10.setAttribute('rotation', '270 90 0');
  marker10.appendChild(ent10);

  // Marker 15 - Brandenburger Tor OBJ/MTL
  const marker15 = document.querySelector('a-marker[value="15"]');
  const ent15 = document.createElement('a-entity');
  ent15.setAttribute('obj-model', 'obj: #bbtor-obj; mtl: #bbtor-mtl');
  ent15.setAttribute('position', '0 -1 -1');
  ent15.setAttribute('scale', '0.3 0.3 0.3');
  ent15.setAttribute('rotation', '270 90 0');
  marker15.appendChild(ent15);

  // Marker 9 - TV Tower OBJ/MTL
  const marker9 = document.querySelector('a-marker[value="9"]');
  const ent9 = document.createElement('a-entity');
  ent9.setAttribute('obj-model', 'obj: #tv-obj; mtl: #tv-mtl');
  ent9.setAttribute('position', '0 -1 -1');
  ent9.setAttribute('scale', '0.009 0.009 0.009');
  ent9.setAttribute('rotation', '0 0 0');
  marker9.appendChild(ent9);

  // Marker 1 - Image plane (imgtest)
  const marker1 = document.querySelector('a-marker[value="1"]');
  const imgPlane1 = document.createElement('a-plane');
  imgPlane1.setAttribute('position', '0 0 -1');
  imgPlane1.setAttribute('rotation', '-90 0 0');
  imgPlane1.setAttribute('material', 'src: #imgtest');
  marker1.appendChild(imgPlane1);

  // Marker 2 - Video plane
  const marker2 = document.querySelector('a-marker[value="2"]');
  const videoPlane = document.createElement('a-plane');
  videoPlane.setAttribute('position', '0 0 0');
  videoPlane.setAttribute('rotation', '-90 0 0');
  videoPlane.setAttribute('material', 'src: #vidtest');
  marker2.appendChild(videoPlane);

  // Marker 12 - Image plane (fridge)
  const marker12 = document.querySelector('a-marker[value="12"]');
  const imgPlane2 = document.createElement('a-plane');
  imgPlane2.setAttribute('position', '0 0 -1');
  imgPlane2.setAttribute('rotation', '-90 0 0');
  imgPlane2.setAttribute('material', 'src: #fridge');
  marker12.appendChild(imgPlane2);

  console.log("All entities inserted and ready!");
}

});
</script>

</body>
</html>
